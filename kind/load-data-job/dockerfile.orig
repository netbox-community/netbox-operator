ARG PYTHON_BASE_IMAGE=python:3.12
FROM ${PYTHON_BASE_IMAGE}

# Optional Artifactory pip index
ARG ARTIFACTORY_PYPI_URL=""
ARG ARTIFACTORY_TRUSTED_HOST=""

# Set envs so theyâ€™re usable in RUN commands
ENV ARTIFACTORY_PYPI_URL=${ARTIFACTORY_PYPI_URL}
ENV ARTIFACTORY_TRUSTED_HOST=${ARTIFACTORY_TRUSTED_HOST}

ADD main.py .

# Conditional pip install using Artifactory if set
RUN if [ -n "$ARTIFACTORY_PYPI_URL" ]; then \
      echo "Using Artifactory pip index: $ARTIFACTORY_PYPI_URL"; \
      pip install -Iv pynetbox==7.4.1 \
        --index-url="$ARTIFACTORY_PYPI_URL" \
        --trusted-host="$ARTIFACTORY_TRUSTED_HOST"; \
    else \
      echo "Using public PyPI"; \
      pip install -Iv pynetbox==7.4.1; \
    fi

CMD ["python", "./main.py"]
